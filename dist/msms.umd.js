!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.msms={})}(this,function(t){var e=function(t,e){if(void 0===t)throw new Error(e+" is not a store")},n=function(t){var e=new WeakMap,n={get:function(t,o){var r=t[o],u=e.get(r);return"object"!=typeof r||u||(u=new Proxy(r,n),e.set(r,u)),u||r},set:function(){}};return new Proxy(t,n)},o=new Map,r=function(t){var e=t.schema,o=n(t.state);return function(n,r){if(function(t,n){if(void 0===e[n]&&"EFFECTS"!==n)throw new Error(n+" is not a prop")}(0,n),"EFFECTS"===n)return e.EFFECTS[r](o,t.send);var u=e[n],a=u.validate,f=(0,u.action)(o,r);return!(a&&!a(f)||t.state[n]===f||(t.state[n]=f,t.funcs.forEach(function(t,e){t.has(n)&&e(Object.assign({},o))}),0))}},u=function(t,e){return function(n){t.funcs.has(n)||t.funcs.set(n,new Set(e||t.props))}},a=function(t){return function(e){t.funcs.delete(e)}};t.create=function(t,e){var n=function(t){var e={},n={};for(var o in t){var r=t[o];"EFFECTS"!==o&&("object"==typeof r?(e[o]=void 0!==r.default?r.default:r.action({}),n[o]=r):(e[o]=r({}),n[o]={action:r}))}return n.EFFECTS=t.EFFECTS,{state:e,usedSchema:n,props:Object.keys(e)}}(e),u={state:n.state,props:n.props,schema:n.usedSchema,queue:[],funcs:new Map};u.send=r(u),o.set(t,u)},t.use=function(t,f){var s=o.get(t);return e(s,t),function(t,e){e&&e.forEach(function(e){if(void 0===t.schema[e])throw new Error(e+" is not a prop")})}(s,f),[r(s),n(s.state),u(s,f),a(s)]},t.get=function(t){var r=o.get(t);return e(r,t),n(r.state)},t.destroy=function(t){return o.delete(t)}});
