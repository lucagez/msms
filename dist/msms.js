var t=function(t,n){if(void 0===t)throw new Error(n+" is not a store")},n=new Map,e=function(t){var n=new Proxy(t.state,{set:function(){}});return function(e,r){var o=t.schema[e];!function(t,n){if(void 0===o)throw new Error(n+" is not a prop")}(0,e);var a=o.validate,u=(0,o.action)(n,r);if(a&&!a(u))return!1;if(t.state[e]===u)return!1;t.state[e]=u;for(var s=0,c=t.funcs;s<c.length;s+=1){var i=c[s],f=i[0];i[1].has(e)&&f(n)}return!0}},r=function(t,n){return function(e){t.funcs.has(e)||t.funcs.set(e,new Set(n||t.props))}},o=function(t){return function(n){t.funcs.delete(n)}},a=function(t){return new Proxy(t,{set:function(){}})};exports.create=function(t,r){var o=function(t){var n={},e={};for(var r in t){var o=t[r];"object"==typeof o?(n[r]=void 0!==o.default?o.default:o.action({}),e[r]=o):(n[r]=o({}),e[r]={action:o})}return{state:n,usedSchema:e,props:Object.keys(n)}}(r),a=o.state,u={state:a,props:o.props,schema:o.usedSchema,queue:[],funcs:new Map};a.send=e(u),n.set(t,u)},exports.use=function(u,s){var c=n.get(u);return t(c,u),function(t,n){n&&n.forEach(function(n){if(void 0===t.schema[n])throw new Error(n+" is not a prop")})}(c,s),[e(c),r(c,s),o(c),a(c.state)]},exports.get=function(e){var r=n.get(e);return t(r,e),a(r.state)},exports.destroy=function(t){return n.delete(t)};
