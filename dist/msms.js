var t=function(t,e){if(void 0===t)throw new Error(e+" is not a store")},e=function(t){var e=new WeakMap,n={get:function(t,r){var o=t[r],a=e.get(o);return"object"!=typeof o||a||(a=new Proxy(o,n),e.set(o,a)),a||o},set:function(){}};return new Proxy(t,n)},n=new Map,r=function(t){var n=t.schema,r=e(t.state);return function(e,o){if(function(t,e){if(void 0===n[e]&&"EFFECTS"!==e)throw new Error(e+" is not a prop")}(0,e),"EFFECTS"===e)return n.EFFECTS[o](r,t.send);var a=n[e],s=a.validate,u=(0,a.action)(r,o);return!(s&&!s(u)||t.state[e]===u||(t.state[e]=u,t.funcs.forEach(function(t,n){t.has(e)&&n(Object.assign({},r))}),0))}},o=function(t,e){return function(n){t.funcs.has(n)||t.funcs.set(n,new Set(e||t.props))}},a=function(t){return function(e){t.funcs.delete(e)}};exports.create=function(t,e){var o=function(t){var e={},n={};for(var r in t){var o=t[r];"EFFECTS"!==r&&("object"==typeof o?(e[r]=void 0!==o.default?o.default:o.action({}),n[r]=o):(e[r]=o({}),n[r]={action:o}))}return n.EFFECTS=t.EFFECTS,{state:e,usedSchema:n,props:Object.keys(e)}}(e),a={state:o.state,props:o.props,schema:o.usedSchema,queue:[],funcs:new Map};a.send=r(a),n.set(t,a)},exports.use=function(s,u){var c=n.get(s);return t(c,s),function(t,e){e&&e.forEach(function(e){if(void 0===t.schema[e])throw new Error(e+" is not a prop")})}(c,u),[r(c),e(c.state),o(c,u),a(c)]},exports.get=function(r){var o=n.get(r);return t(o,r),e(o.state)},exports.destroy=function(t){return n.delete(t)};
