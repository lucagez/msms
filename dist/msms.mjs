var t=function(t,n){if(void 0===t)throw new Error(n+" is not a store")},n=function(t){var n=new WeakMap,e={get:function(t,r){var o=t[r],a=n.get(o);return"object"!=typeof o||a||(a=new Proxy(o,e),n.set(o,a)),a||o},set:function(){}};return new Proxy(t,e)},e=new Map,r=function(t){var e=t.schema,r=n(t.state);return function(n,o){if(function(t,n){if(void 0===e[n]&&"EFFECTS"!==n)throw new Error(n+" is not a prop")}(0,n),"EFFECTS"===n)return e.EFFECTS[o](r,t.send);var a=e[n],u=a.validate,c=(0,a.action)(r,o);return!(u&&!u(c)||t.state[n]===c||(t.state[n]=c,t.funcs.forEach(function(t,e){t.has(n)&&e(Object.assign({},r))}),0))}},o=function(t,n){return function(e){t.funcs.has(e)||t.funcs.set(e,new Set(n||t.props))}},a=function(t){return function(n){t.funcs.delete(n)}},u=function(t,n){var o=function(t){var n={},e={};for(var r in t){var o=t[r];"EFFECTS"!==r&&("object"==typeof o?(n[r]=void 0!==o.default?o.default:o.action({}),e[r]=o):(n[r]=o({}),e[r]={action:o}))}return e.EFFECTS=t.EFFECTS,{state:n,usedSchema:e,props:Object.keys(n)}}(n),a={state:o.state,props:o.props,schema:o.usedSchema,queue:[],funcs:new Map};a.send=r(a),e.set(t,a)},c=function(r){var o=e.get(r);return t(o,r),n(o.state)},s=function(u,c){var s=e.get(u);return t(s,u),function(t,n){n&&n.forEach(function(n){if(void 0===t.schema[n])throw new Error(n+" is not a prop")})}(s,c),[r(s),n(s.state),o(s,c),a(s)]},i=function(t){return e.delete(t)};export{u as create,s as use,c as get,i as destroy};
