{"version":3,"file":"msms.umd.js","sources":["../src/prepareSchema.js","../src/errors.js","../src/stores.js","../src/cp.js","../src/functions.js","../src/msms.js"],"sourcesContent":["const prepareSchema = (schema) => {\n  const state = {};\n  const usedSchema = {};\n\n  for (const prop in schema) {\n    const current = schema[prop];\n    if (typeof current === 'object') {\n      state[prop] = typeof current.default !== 'undefined'\n        ? current.default\n        : current.action({});\n\n      usedSchema[prop] = current;\n    } else {\n      state[prop] = current({});\n      usedSchema[prop] = { action: current };\n    }\n  }\n\n  return {\n    state,\n    usedSchema,\n    props: Object.keys(state),\n  };\n};\n\nexport default prepareSchema;\n","const errors = {\n  prop: (obj, prop) => {\n    if (typeof obj === 'undefined') {\n      throw new Error(`${prop} is not a prop`);\n    }\n  },\n\n  store: (obj, name) => {\n    if (typeof obj === 'undefined') {\n      throw new Error(`${name} is not a store`);\n    }\n  },\n\n  alloweds: (obj, alloweds) => {\n    if (alloweds) {\n      alloweds\n        .forEach((allowed) => {\n          if (typeof obj.schema[allowed] === 'undefined') {\n            throw new Error(`${allowed} is not a prop`);\n          }\n        });\n    }\n  },\n};\n\nexport default errors;\n","const stores = new Map();\n\nexport default stores;\n","const template = params => `\n(function ({${params}}) {\n  return {${params}};\n})\n`;\n\nconst cp = (arr) => {\n  const params = [];\n\n  for (let i = 0; i < arr.length; i++) {\n    params.push(arr[i]);\n  }\n\n  const strParams = params.join(',');\n\n  return eval(template(strParams));\n};\n\nexport default cp;\n","import errors from './errors';\nimport cp from './cp';\n\nconst _copy = (props, state) => {\n  const copyFunc = cp(props);\n  return {\n    copyFunc,\n    copy: () => copyFunc(state),\n  };\n};\n\nconst _send = store => (prop, arg) => {\n  const { length } = store.queue;\n  const current = store.schema[prop];\n\n  errors.prop(current, prop);\n\n  const { validate, action } = current;\n\n  const state = action(store.state, arg);\n\n  if (validate && !validate(state)) return false;\n  if (store.state[prop] === state) return false;\n\n  store.state[prop] = state;\n\n  // Dispatching in O(n) time üòç\n  for (let i = 0; i < length; i++) {\n    const { list, copy, func } = store.queue[i];\n\n    if (list.has(prop)) {\n      func(copy(store.state));\n    }\n  }\n\n  return true;\n};\n\nconst _on = (store, props, copy) => (func) => {\n  if (store.list.has(func)) return;\n\n  store.queue.push({\n    func,\n    list: new Set(props),\n    copy,\n  });\n};\n\nconst _off = store => (func) => {\n  store.list.delete(func);\n  store.queue = store.queue\n    .filter(({ func: current }) => func !== current);\n};\n\nexport {\n  _send,\n  _on,\n  _off,\n  _copy,\n};\n","import prepareSchema from './prepareSchema';\nimport errors from './errors';\nimport stores from './stores';\nimport {\n  _send,\n  _on,\n  _off,\n  _copy,\n} from './functions';\n\nconst create = (name, schema) => {\n  const { state, props, usedSchema } = prepareSchema(schema);\n\n  const store = {\n    state,\n    props,\n    schema: usedSchema,\n    queue: [],\n    list: new Set(),\n  };\n\n  stores.set(name, store);\n};\n\nconst get = (name) => {\n  const store = stores.get(name);\n\n  errors.store(store, name);\n\n  return store.state;\n};\n\nconst use = (name, alloweds) => {\n  const store = stores.get(name);\n\n  errors.store(store, name);\n  errors.alloweds(store, alloweds);\n\n  const usedProps = alloweds || store.props;\n\n  const { copy, copyFunc } = _copy(usedProps, store.state);\n\n  return [\n    _send(store),\n    _on(store, usedProps, copyFunc),\n    _off(store),\n    copy,\n  ];\n};\n\nconst destroy = name => stores.delete(name);\n\nexport {\n  create,\n  use,\n  get,\n  destroy,\n};\n"],"names":["const","prepareSchema","schema","state","usedSchema","prop","current","default","action","props","Object","keys","errors","obj","Error","store","name","alloweds","forEach","allowed","stores","Map","template","params","cp","arr","let","i","length","push","strParams","join","eval","_copy","copyFunc","copy","_send","arg","queue","validate","list","func","has","_on","Set","_off","delete","filter","create","set","get","use","usedProps","destroy"],"mappings":"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"}